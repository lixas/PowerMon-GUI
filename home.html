<template>
	<div class="page no-navbar">
		<div class="page-content">
			<div class="navbar">
				<div class="navbar-bg"></div>
				<div class="navbar-inner">
					<div class="left">
						<a class="link panel-open icon-only" data-panel="left">
							<i class="icon f7-icons">bars</i>
						</a>
					</div>
					<div class="title">Power Monitor</div>
					<div class="right">
						<a href="#" @click=${BLEconnectAlert} class="link icon-only navbar-tooltip">
							<i class="icon f7-icons">bolt</i>
							<!-- <i class="icon f7-icons">bolt_slash</i> -->
						</a>
					</div>
				</div>
			</div>
<!-- Area Chart element -->
			<div style="width: 100%;"><canvas id="measurements-chart"></canvas></div>
<!-- main content begin -->
			<div class="block">
				<div class="data-table">
					<table>
						<thead>
							<tr>
								<th class="label-cell">Measurement</th>
								<th class="numeric-cell">Value</th>
								<th class="text-cell">Unit</th>
							</tr>
						</thead>
						<tbody>
							${window.Measurements.filter(item => item.checked).map((item) => $h`
							<tr id="Measurement-${item.key}">
								<td class="label-cell">${item.title}</td>
								<td class="numeric-cell">0</td>
								<td class="text-cell">${item.val[item.idx]}</td>
							</tr>
							`)}
						</tbody>
					</table>
				</div>
<!-- Remote control buttons -->
				<div class="block-title">
					<a href="#" @click=${remoteControlInfo}><i class="icon f7-icons">info_circle</i></a>
						Device remote control
				</div>
				<div class="block block-strong block-outline-ios">
					<div class="grid grid-cols-4 grid-gap">
						<button @click=${ControlButton.bind(null, 'Setup')} class="button button-tonal">Setup</button>
						<button @click=${ControlButton.bind(null, 'Minus')} class="button button-tonal">-</button>
						<button @click=${ControlButton.bind(null, 'Plus')} class="button button-tonal">+</button>
						<button @click=${ControlButton.bind(null, 'Enter')} class="button button-tonal">Enter</button>
					</div>
				</div>
				<!-- <div class="block-footer">tooter text</div> -->
<!-- / Remote control buttons -->
			</div>
		</div>
	</div>
</template>

<script>
  export default (props, { $f7, $onMounted, $onBeforeUnmount }) => {
		
		const remoteControlInfo = () => {
			$f7.dialog.alert('Using these buttons you can control device. You must have visual with the device to see what you are doing.', 'Remote Control');
		}

		const BLEconnectAlert = () => {
			$f7.dialog.alert('Clicking this button would show dialog to connect Atorch device', '');
		}
		
		// Will be split into separate functions
		const ControlButton = (atr) => {
			$f7.toast.create({
				text: atr + ' button has been pressed',
				position: 'center',
				closeTimeout: 2000,
				closeButton: true,
			}).open();
		}
		
		// document.getElementById('Measurement-Vol').children[1].innerHTML="7"
		
		$onMounted(() => {
			
			$f7.tooltip.create({
				targetEl: '.navbar-tooltip',
				text: 'Connect<br /> to <br /><em>BLE</em>',
			});
			
			const data = [
				{ year: 2010, v: 10, c: 20, p: 200 },
				{ year: 2011, v: 20, c: 15, p: 300 },
				{ year: 2012, v: 15, c: 25, p: 375 },
				{ year: 2013, v: 25, c: 22, p: 550 },
				{ year: 2014, v: 22, c: 30, p: 660 },
				{ year: 2015, v: 30, c: 28, p: 840 },
				{ year: 2016, v: 28, c: 10, p: 280 },
			];
			
			let jschart =new Chart(
				document.getElementById('measurements-chart'),
				{
					type: 'line',
					data: {
						labels: data.map(row => row.year),
						datasets: [
							{
								label: 'Voltage',
								data: data.map(row => row.v),
								yAxisID: 'left-y-axis'
							},
							{
								label: 'Current',
								data: data.map(row => row.c),
								yAxisID: 'right-y-axis-1',

							},
							{
								label: 'Power',
								data: data.map(row => row.p),
								yAxisID: 'right-y-axis-2',
								type: 'bar',
							}
						]
					},
					options: {
						scales: {
							'left-y-axis': {
								type: 'linear',
								position: 'left',
								// min: 0,
								title: {
									display: true,
									text: 'Voltage'
								},
							},
							'right-y-axis-1': {
								type: 'linear',
								position: 'right',
								title: {
									display: true,
									text: 'Current'
								},
							},
							'right-y-axis-2': {
								type: 'linear',
								position: 'right',
								title: {
									display: true,
									text: 'Power'
								},
							}
						}
					},
				}
			);
		}) //END $onMounted
		
		$onBeforeUnmount(() => {
			// areaLines.destroy();
			jschart.destroy();
		})
		
		return $render;
	}
</script>